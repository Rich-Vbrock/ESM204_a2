---
title: "ESM204_a2"
author: "Richard Viebrock"
date: "4/19/2020"
output:
  pdf_document: default
---

```{r setup, include=FALSE, ncols = 2}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}

# Attach necessary packaegs

library(tidyverse)
library(ggplot2)
library(wesanderson)
library(janitor)
library(broom)
library(nlstools)

```

```{r}

# Read in data

raw_data <- read_csv("HW2_Data.csv") %>% 
  clean_names()

```

```{r}

# Check relationship between data
# Linear appears appropriate for a & b

#  raw_data_02 <- raw_data %>% 
#    pivot_longer("mc_a":"mc_d", 
#                names_to = "sector", 
#                  values_to = "mc")
#  
#  ggplot(data = raw_data_02, aes(sample = mc))+
#   geom_qq()+
#    geom_qq_line()+
#    facet_wrap(~sector)
# 
# # Plot estimated marginal abatement costs
# 
#  ggplot(data = raw_data_02, aes(x = abatement, y = mc))+
#    geom_line()+
#    geom_point()+
#    stat_smooth(method = "lm",
#                se = FALSE,
#                formula=y ~ poly(x, 2, raw=TRUE))+
#    facet_wrap(~sector,
#              scale = "free")
# 
#  ggplot(data = raw_data_02, aes(x = abatement, y = mc))+
#    geom_line()+
#    geom_point()+
#    geom_smooth(method = "lm",
#                se = FALSE)+
#    facet_wrap(~sector,
#               scale = "free")

```

```{r}
# Create function to estimate abatement costs

a_lm <- lm(mc_a ~ abatement, data = raw_data)
b_lm <- lm(mc_b ~ abatement, data = raw_data)
c_lm <- lm(mc_c ~ abatement, data = raw_data)
d_lm <- lm(mc_d ~ abatement, data = raw_data)
summary(d_lm)

# b_lm_02 <- lm(mc_b ~ poly(abatement, 2, raw = TRUE), data = raw_data)
# b_nls <- nls(mc_b ~ K/(1 + A*exp(-r*abatement)), data = raw_data,
#              start = list(K = 60,
#                           A = 50,
#                           r = 0.39),
#              trace = TRUE)

# b_lm <- lm(mc_b ~ poly(abatement, 2, raw = TRUE), data = raw_data)
# c_lm <- lm(mc_c ~ poly(abatement, 2, raw = TRUE), data = raw_data)
# d_lm <- lm(mc_d ~ poly(abatement, 2, raw = TRUE), data = raw_data)

```

```{r}
# Naming Things
a_y <- a_lm$coefficients[1]
a_1 <- a_lm$coefficients[2]
b_y <- b_lm$coefficients[1]
b_1 <- b_lm$coefficients[2]
c_y <- c_lm$coefficients[1]
c_1 <- c_lm$coefficients[2]
d_y <- d_lm$coefficients[1]
d_1 <- d_lm$coefficients[2]
```

```{r}

# Create functions using lm()'s

a_eq <- function(x) {y = a_y + a_1*x}
b_eq <- function(x) {y = b_y + b_1*x}
c_eq <- function(x) {y = c_y + c_1*x}
d_eq <- function(x) {y = d_y + d_1*x}
z <- 0:150

a_demand <- function(q) {y = a_y + a_1*(170-q)}
b_demand <- function(q) {y = b_y + b_1*(200-q)}
c_demand <- function(q) {y = c_y + c_1*(230-q)}
d_demand <- function(q) {y = d_y + d_1*(300-q)}
za <- 0:250

# b_eq_huh <- function(x) {y = (58.18640)/(1+10.56466*exp(-0.04849*x))}
# b_eq_quad <- function(x) {y = -2.008211 + 0.854358*(x) + -0.003084*(x)^2}
# c_eq <- function(x) {y = 0.321580*(x) + 0.005390*(x^2) - 7.941422}
# d_eq <- function(x) {y = 2.098529 - 0.059765*x + 0.004088*x^2}
# c_eq <- function(x) {y = 1.563e-02*x^2 -2.735e-01*x - 4.553e-05*x^3 - 1.726e+00}
# a_eq_demand <- function(q) {y = 1.663 + 0.513*(170) - 0.513*(q)}
# b_eq_demand <- function(q) {y = y = 8.78529 + 0.39178*(200) - 0.39178*(q)}
# b_eq_demand <- function(q) {y = 8.7853 + 0.3918*(200) - 0.3918*(q)}
# c_eq_demand <- function(q) {y = 0.321580*(230 - q) + 0.005390*(230 - q)*(230 - q) - 7.941422}
# d_eq_demand <- function(q) {y = 2.098529 - 0.059765*(300 - q) + 0.004088*(300 - q)^2}

```

```{r, out.width = c('50%', '50%'), fig.show = 'hold'}

# Use functions to graph marginal abatement cost curve

ggplot() +
  stat_function(aes(z), color = "darkred", fun = a_eq, size = 1, show.legend = FALSE)+
  stat_function(aes(z), color = "darkblue", fun = b_eq, size = 1, show.legend = FALSE)+
  stat_function(aes(z), color = "darkorange", fun = c_eq, size = 1, show.legend = FALSE)+
  stat_function(aes(z), color = "darkgreen", fun = d_eq, size = 1, show.legend = FALSE)+
  scale_y_continuous(limits = c(0, 300),
                     expand = c(0, 0))+
  scale_x_continuous(limits = c(0, 250),
                     expand = c(0, 0))+
  labs(x = "Abatement (Metric Tons)", 
       y = "Price (USD / Metric Ton)",
       title = "Marginal Abatement Cost")+
  theme_classic()

ggplot()+
  stat_function(aes(za), color = "darkred", fun = a_demand, size = 1, show.legend = FALSE)+
  stat_function(aes(za), color = "darkblue", fun = b_demand, size = 1, show.legend = FALSE)+
  stat_function(aes(za), color = "darkorange", fun = c_demand, size = 1, show.legend = FALSE)+
  stat_function(aes(za), color = "darkgreen", fun = d_demand, size = 1, show.legend = FALSE)+
  scale_y_continuous(limits = c(0, 300),
                     expand = c(0, 0))+
  scale_x_continuous(limits = c(0, 250),
                     expand = c(0, 0))+
  labs(x = "Pollution (Metric Tons)",
       y = "Price (USD / Metric Ton)",
       title = "Demand for Pollution")+
  theme_classic()

```

```{r}




```

